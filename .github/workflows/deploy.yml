name: D√©ploiement sur GitHub Pages

on:
  push:
    branches:
      - main
    paths:
      - 'index.html'
      - '.github/workflows/deploy.yml'
  # Permet de d√©clencher manuellement le workflow
  workflow_dispatch:

# D√©finit les permissions n√©cessaires pour GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# Autorise un seul d√©ploiement simultan√©
concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  # Job de construction et d√©ploiement
  build-and-deploy:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
      # √âtape 1: R√©cup√©ration du code
      - name: Checkout du code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      # √âtape 2: Configuration de Pages
      - name: Configuration de GitHub Pages
        uses: actions/configure-pages@v4
      
      # √âtape 3: Construction du site (ici simple copie pour site statique)
      - name: Construction du site
        run: |
          echo "üì¶ Construction du site statique..."
          # V√©rification du fichier index.html
          if [ ! -f "index.html" ]; then
            echo "‚ùå Fichier index.html non trouv√©!"
            exit 1
          fi
          
          # Cr√©ation d'un fichier de version pour suivre les d√©ploiements
          echo "Dernier d√©ploiement: $(date)" > version.txt
          echo "Commit: ${{ github.sha }}" >> version.txt
          echo "Workflow: ${{ github.workflow }}" >> version.txt
          
          # Cr√©ation d'un fichier de configuration pour GitHub Pages
          echo "Configuration GitHub Pages cr√©√©e avec succ√®s"
      
      # √âtape 4: T√©l√©versement des artefacts
      - name: T√©l√©versement des artefacts
        uses: actions/upload-pages-artifact@v3
        with:
          path: .
      
      # √âtape 5: D√©ploiement sur GitHub Pages
      - name: D√©ploiement sur GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
      
      # √âtape 6: Notification de succ√®s
      - name: Notification de succ√®s
        if: success()
        run: |
          echo "‚úÖ D√©ploiement r√©ussi!"
          echo "üåê Votre site est disponible √† l'adresse: ${{ steps.deployment.outputs.page_url }}"
      
      # √âtape 7: Notification d'√©chec
      - name: Notification d'√©chec
        if: failure()
        run: |
          echo "‚ùå √âchec du d√©ploiement"
          echo "V√©rifiez les logs pour plus d'informations"
